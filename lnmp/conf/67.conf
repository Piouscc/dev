
#wss
server{
	listen 9167;
	server_name	#platform#;
	
	#ssl on;
	#ssl_certificate 67/#domain#.crt;
	#ssl_certificate_key 67/#domain#.key;
	#ssl_session_timeout 5m;
	#ssl_protocols TLSv1.1 TLSv1.2;
	#ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
	#ssl_prefer_server_ciphers on;

	location / {
		proxy_pass http://127.0.0.1:9067;
	}
}

#platform
server{
	listen	80;
	server_name	#platform#;
	index	index.html index.htm index.php;
	root	/www/67/platform;
	
	#listen 443 ssl;
	#ssl_certificate 67/#domain#.crt;
	#ssl_certificate_key 67/#domain#.key;
	#ssl_session_timeout 5m;
	#ssl_protocols TLSv1.1 TLSv1.2;
	#ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
	#ssl_prefer_server_ciphers on;
	
	#if ($scheme != 'https') {
	#	rewrite ^/.* https://$host/$1 permanent;
	#}
	
	error_page 403 404 /error_page/404.html;
	error_page 500 501 502 503 504 /error_page/50x.html;
	
	location = /error_page/50x.html {
		access_log	/var/#NAME#/log/platform.50x.php.log access;
	}

	location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|js|css|woff|woff2|svg|ttf|eot|ico)$ {
		expires	30d;
		access_log	off;
	}
	
	location ^~ /data2/ {
		return 403;
	}
	location ^~ /controllers/ {
		return 403;
	}
	location ^~ /admin/ {
		return 403;
	}
	location ^~ /include/ {
		return 403;
	}
	location ^~ /view/ {
		return 403;
	}

	location ~ \.php {
		limit_req zone=php burst=60 nodelay;
		
		include	fastcgi.conf;
		fastcgi_pass	127.0.0.1:9000;
		fastcgi_index	index.php;
		fastcgi_split_path_info	^(.+\.php)(/.+)$;
	}

	if (!-e $request_filename) {
		rewrite "^/([a-zA-Z0-9]{17})" /encrypt_route.php?iv=$1 last;
		rewrite ^/(.*) /index.php/$1 last;
	}
	
	access_log	/var/#NAME#/log/platform.nginx.log	access;
}


#ad
server{
	listen	80;
	server_name	#adv#;
	index	index.html index.htm index.php;
	root	/www/67/adv;
	
	#listen 443 ssl;
	#ssl_certificate 67/#domain#.crt;
	#ssl_certificate_key 67/#domain#.key;
	#ssl_session_timeout 5m;
	#ssl_protocols TLSv1.1 TLSv1.2;
	#ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
	#ssl_prefer_server_ciphers on;
	
	#if ($scheme != 'https') {
	#	rewrite ^/.* https://$host/$1 permanent;
	#}
	
	location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|js|css|woff|woff2|svg|ttf|eot|ico)$ {
		expires	30d;
		access_log	off;
	}
	
	location ^~ /data2/ {
		return 403;
	}
	location ^~ /admin/ {
		return 403;
	}
	location ^~ /controllers/ {
		return 403;
	}
	
	location ~ \.php {
		limit_req zone=php burst=60 nodelay;
		
		include fastcgi.conf;
		fastcgi_pass	127.0.0.1:9000;
		fastcgi_index	index.php;
		fastcgi_split_path_info	^(.+\.php)(/.+)$;
	}
	
	if (!-e $request_filename) {
		rewrite "^/([a-z0-9]{8})/$" /index.php?domain=#xx.com#&uniq=$1 last;
		rewrite ^/(.*) /index.php/$1 last;
	}
	
	access_log	/var/#NAME#/www_log/$host.adv.log	access;
}



#sites
server {
	listen	80;
	server_name	#*.sites#;
	index	index.html index.htm index.php;
	root	/www/67/platform;
	
	#listen 443 ssl;
	#ssl_certificate 67/#domain#.crt;
	#ssl_certificate_key 67/#domain#.key;
	#ssl_session_timeout 5m;
	#ssl_protocols TLSv1.1 TLSv1.2;
	#ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
	#ssl_prefer_server_ciphers on;
	
	#if ($scheme != 'https') {
	#	rewrite ^/.* https://$host/$1 permanent;
	#}
	
	error_page 403 404 /error_page/404.html;
	error_page 500 501 502 503 504 /error_page/50x.html;
	
	location = /error_page/50x.html {
		access_log	/var/#NAME#/www_log/$host.50x.log access;
	}
	
	location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|js|css|woff|woff2|svg|ttf|eot|ico)$ {
		expires	30d;
		access_log	off;
	}
	
	location ^~ /data2/ {
		return 403;
	}
	location ^~ /admin/ {
		return 403;
	}
	location ^~ /controllers/ {
		return 403;
	}
	location ^~ /view/ {
		return 403;
	}
	
	if ($host ~* "(?<aname>abc)\.(?:xxx\.com)$"){
		
	}
	
	location ~ \.php {
		limit_req zone=php burst=60 nodelay;
		
		include fastcgi.conf;
		fastcgi_pass	127.0.0.1:9000;
		fastcgi_index	index.php;
		fastcgi_split_path_info ^(.+\.php)(/.+)$;
		fastcgi_param HTTP_ANAME $aname;
	}
	
	if (!-e $request_filename) {
		rewrite ^/(.*) /index.php/$1 last;
	}
	
	access_log	/var/#NAME#/log/$host.nginx.log access;
}
